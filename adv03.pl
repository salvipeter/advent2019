% -*- mode: prolog -*-

% check_wire(+Wire, +Positions, -Positions1)
check_wire([], Ps, Ps).
check_wire([W|Ws], [P|Ps], Ps2) :- move(P, W, [P1|Ps1]-Ps), check_wire(Ws, [P1|Ps1], Ps2).

move(P, _-0, [P|X]-X).
move(P, D-N, Ps-X) :- N > 0, N1 is N - 1, step(P, D, P1), move(P1, D-N1, Ps-[P|X]).

step(X-Y, r, X1-Y) :- X1 is X + 1.
step(X-Y, l, X1-Y) :- X1 is X - 1.
step(X-Y, u, X-Y1) :- Y1 is Y + 1.
step(X-Y, d, X-Y1) :- Y1 is Y - 1.

duplicates([], []).
duplicates([_], []).
duplicates([X,X|Xs], [X|Ys]) :- duplicates(Xs, Ys). % allows duplicate duplicates
duplicates([X,Y|Xs], Ys) :- X \= Y, duplicates([Y|Xs], Ys).

manhattan(X-Y, M) :- M is abs(X) + abs(Y).

adv03(X) :-
    wires(W1, W2), check_wire(W1, [0-0], Ps1), check_wire(W2, [0-0], Ps2),
    reverse(Ps1, [0-0|R1]), sort(R1, S1), sort(Ps2, S2), append(S1, S2, A), msort(A, S),
    duplicates(S, I), maplist(manhattan, I, M), min_list(M, X).

nsteps2(W1, W2, P, N) :- nsteps(W1, 0-0, P, N1), nsteps(W2, 0-0, P, N2), N is N1 + N2.

nsteps(_, P, P, 0).
nsteps([W|Ws], P, Q, N) :-
    move(P, W, S-[]), length(S, N1),
    ( position(Q, S, N2), N is N1 - N2 - 1
    ; S = [P1|_], nsteps(Ws, P1, Q, N2), N is N1 + N2 - 1
    ).

position(X, [X|_], 0).
position(X, [Y|Ys], N) :- X \= Y, position(X, Ys, N1), N is N1 + 1.

% same as adv03, except for the manhattan part
adv03b(X) :-
    wires(W1, W2), check_wire(W1, [0-0], Ps1), check_wire(W2, [0-0], Ps2),
    reverse(Ps1, [0-0|R1]), sort(R1, S1), sort(Ps2, S2), append(S1, S2, A), msort(A, S),
    duplicates(S, I), maplist(nsteps2(W1, W2), I, M), min_list(M, X).

% Data

wires([r-1009,u-263,l-517,u-449,l-805,d-78,l-798,d-883,l-777,d-562,r-652,d-348,r-999,d-767,l-959,u-493,r-59,d-994,l-225,d-226,r-634,d-200,r-953,u-343,l-388,u-158,r-943,u-544,l-809,d-785,r-618,u-499,l-476,u-600,l-452,d-693,l-696,u-764,l-927,d-346,l-863,d-458,l-789,u-268,r-586,u-884,l-658,d-371,l-910,u-178,r-524,u-169,r-973,d-326,r-483,u-233,r-26,u-807,l-246,d-711,l-641,d-75,r-756,u-365,r-203,d-377,r-624,u-430,l-422,u-367,r-547,u-294,l-916,d-757,r-509,d-332,r-106,d-401,l-181,u-5,l-443,u-197,r-406,d-829,r-878,u-35,l-958,u-31,l-28,d-362,r-188,d-582,r-358,u-750,r-939,d-491,r-929,d-513,l-541,u-418,r-861,d-639,l-917,u-582,r-211,u-725,r-711,d-718,l-673,u-921,l-157,u-83,l-199,u-501,l-66,d-993,l-599,d-947,l-26,u-237,l-981,u-833,l-121,u-25,r-641,d-372,l-757,d-645,r-287,u-390,r-274,u-964,r-288,d-209,r-109,d-364,r-983,u-715,l-315,u-758,r-36,d-500,r-626,u-893,l-840,u-716,l-606,u-831,l-969,d-643,l-300,d-838,r-31,d-751,l-632,d-702,r-468,d-7,l-169,u-149,r-893,d-33,r-816,d-558,r-152,u-489,l-237,u-415,r-434,d-472,l-198,d-874,l-351,u-148,r-761,u-809,r-21,d-25,r-586,d-338,l-568,u-20,l-157,u-221,l-26,u-424,r-261,d-227,l-551,d-754,l-90,u-110,l-791,u-433,r-840,u-323,r-240,u-124,l-723,d-418,r-938,d-173,l-160,u-293,r-773,u-204,r-192,u-958,l-472,d-703,r-556,d-168,l-263,u-574,l-845,d-932,r-165,d-348,r-811,d-834,r-960,u-877,r-935,d-141,r-696,u-748,l-316,u-236,l-796,d-566,r-524,u-449,r-378,u-480,l-79,u-227,r-867,d-185,r-474,d-757,r-366,u-153,r-882,u-252,r-861,u-900,r-28,u-381,l-845,u-642,l-849,u-352,r-134,d-294,r-788,d-406,l-693,d-697,l-433,d-872,r-78,d-364,r-240,u-995,r-48,d-681,r-727,d-825,l-583,u-44,r-743,d-929,l-616,d-262,r-997,d-15,r-575,u-341,r-595,u-889,r-254,u-76,r-962,d-944,r-724,d-261,r-608,u-753,l-389,d-324,l-569,u-308,l-488,d-358,l-695,d-863,l-712,d-978,r-149,d-177,r-92],[l-1003,d-960,l-10,d-57,r-294,u-538,r-867,d-426,l-524,d-441,r-775,u-308,r-577,d-785,r-495,u-847,r-643,d-895,r-448,u-685,l-253,u-312,l-312,u-753,l-89,u-276,r-799,d-923,l-33,u-595,r-400,u-111,l-664,d-542,r-171,u-709,l-809,d-713,l-483,u-918,l-14,u-854,l-150,d-69,l-158,d-500,l-91,d-800,r-431,d-851,l-798,u-515,l-107,u-413,l-94,u-390,l-17,u-221,l-999,d-546,l-191,u-472,l-568,u-114,l-913,d-743,l-713,d-215,l-569,d-674,l-869,u-549,l-789,u-259,l-330,d-76,r-243,d-592,l-646,u-880,l-363,u-542,l-464,d-955,l-107,u-473,r-818,d-786,r-852,u-968,r-526,d-78,l-275,u-891,r-480,u-991,l-981,d-391,r-83,u-691,r-689,d-230,l-217,d-458,r-10,u-736,l-317,d-145,r-902,d-428,r-344,u-334,r-131,d-739,r-438,d-376,l-652,u-304,l-332,d-452,r-241,d-783,r-82,d-317,r-796,u-323,r-287,d-487,l-302,d-110,r-233,u-631,r-584,u-973,l-878,d-834,l-930,u-472,r-120,u-78,r-806,d-21,l-521,u-988,r-251,d-817,r-44,d-789,r-204,d-669,r-616,d-96,r-624,d-891,l-532,u-154,r-438,u-469,r-785,d-431,r-945,u-649,r-670,d-11,r-840,d-521,l-235,d-69,l-551,d-266,l-454,u-807,l-885,u-590,l-647,u-763,r-449,u-194,r-68,u-809,l-884,u-962,l-476,d-648,l-139,u-96,l-300,u-351,l-456,d-202,r-168,d-698,r-161,u-834,l-273,u-47,l-8,d-157,l-893,d-200,l-454,u-723,r-886,u-92,r-474,u-262,l-190,u-110,l-407,d-723,r-786,d-786,l-572,d-915,l-904,u-744,l-820,d-663,r-205,u-878,r-186,u-247,l-616,d-386,r-582,u-688,l-349,d-399,r-702,u-132,l-276,u-866,r-851,d-633,r-468,d-263,r-678,d-96,l-50,u-946,r-349,d-482,r-487,u-525,r-464,u-977,l-499,d-187,r-546,u-708,l-627,d-470,r-673,d-886,l-375,u-616,l-503,u-38,l-775,d-8,l-982,d-556,r-159,u-680,l-124,u-777,l-640,d-607,r-248,d-671,l-65,d-290,r-445,u-778,l-650,u-679,l-846,d-1,l-769,u-659,r-734,d-962,r-588,u-178,r-888,d-753,r-223,u-318,l-695,d-586,r-430,d-61,r-105,u-801,r-953,u-721,l-856,u-769,r-937,d-335,r-895]).
